let songs = [
    { 
        id: 1,
        name: "As You Like It お気に召すまま",
        artist: "Eve",
        songPath: "../Music web/resources/songs/Japan/Eve - As You Like It  お気に召すまま.mp3",
        img: "../Music web/resources/Images/aulieve.jpg",
    },
         
    { 
        id: 2,
        name: "Attack on Titan Season 2 opening song - Shinzou wo Sasageyo",
        artist: "Linked Horizon",
        songPath: "../Music web/resources/songs/Japan/Attack on Titans OP - Shinzou wo Sasageyo Shingeki no Kyojin S2 OP.mp3",
        img: "../Music web/resources/Images/aot s2 op.jpg",
    },
    
    { 
        id: 3,
        name: "Attack on Titan Season 4 Part 2 ending song - Akuma No Ko",
        artist: "Ai Higuchi",
        songPath: "../Music web/resources/songs/Japan/Attack on Titan - Akuma no Ko  Ai Higuchi.mp3",
        img: "../Music web/resources/Images/aot aku.jpg",
    },
    
    { 
        id: 4,
        name: "Attack on Titan Season 4 Part 2 opening song - The Rumbling",
        artist: "SiM",
        songPath: "../Music web/resources/songs/Japan/Attack on Titans - SiM - The Rumbling.mp3",
        img: "../Music web/resources/Images/rumbling.jpg",
    },
    
    { 
        id: 5,
        name: "Bloom Into You ending song - Hectopascal",
        artist: "Yuu Koito(voiced by Yuuki Takada) & Touko Nanami(voiced by Minako Kotobuki)",
        songPath: "../Music web/resources/songs/Japan/Bloom Into You Ending  hectopascal.mp3",
        img: "../Music web/resources/Images/biu es.jpg",
    },
    
    { 
        id: 6,
        name: "Crying for Rain",
        artist: "Minami",
        songPath: "../Music web/resources/songs/Japan/Minami - Crying for Rain.mp3",
        img: "../Music web/resources/Images/cfrmnm.jpg",
    },
    
    { 
        id: 7,
        name: "Given EP 9 OST - Fuyu no hanashi",
        artist: "Mafuyu(voiced by Shougo Yano)",
        songPath: "../Music web/resources/songs/Japan/Fuyu no hanashi - Given EP 9 OST.mp3",
        img: "../Music web/resources/Images/WinterStoryGiven.webp",
    },
    
    { 
        id: 8,
        name: "Given ギヴン OST - Yorugaakeru 夜が明ける",
        artist: "Given",
        songPath: "../Music web/resources/songs/Japan/Given ギヴン  Yorugaakeru 夜が明ける Dawn Breaks歌詞.mp3",
        img: "../Music web/resources/Images/Given-gift.jpg",
    },
    
    { 
        id: 9,
        name: "Gyutto ぎゅっと",
        artist: "Mosawo もさを",
        songPath: "../Music web/resources/songs/Japan/ぎゅっと Gyutto - もさを Mosawo.mp3",
        img: "../Music web/resources/Images/guytto.jpg",
    },
    
    { 
        id: 10,
        name: "Happy Sugar Life opening song - One Room Sugar Life", 
        artist: "Akari Nanawo",
        songPath: "../Music web/resources/songs/Japan/Happy Sugar Life OP ハピシュガアニメ.mp3", 
        img: "../Music web/resources/Images/hsl.jpg",
    },
    
    { 
        id: 11,
        name: "Hollowness", 
        artist: "Minami",
        songPath: "../Music web/resources/songs/Japan/Minami - Hollowness.webm", 
        img: "../Music web/resources/Images/hollowness.jpg",
    },
    
    { 
        id: 12,
        name: "I'm a Pop", 
        artist: "Chanmina ちゃんみな",
        songPath: "../Music web/resources/songs/Japan/CHANMINA ちゃんみな - Im a Pop.mp3",
        img: "../Music web/resources/Images/cimap.jpg",
    },
    
    { 
        id: 13,
        name: "Josee, the Tiger and the Fish soundtrack - Ao No Waltz 廻廻奇譚",
        artist: "Eve",
        songPath: "../Music web/resources/songs/Japan/Eve - 蒼のワルツ.mp3",
        img: "../Music web/resources/Images/jtf.jpg",
    },
    
    { 
        id: 14,
        name: "Jujutsu kaisen opening song - Kaikai Kitan 蒼のワルツ",
        artist: "Eve",
        songPath: "../Music web/resources/songs/Japan/Eve - 廻廻奇譚 Jujutsu kaisen opening song.mp3",
        img: "../Music web/resources/Images/jjtop.jpg",
    },
    
    { 
        id: 15,
        name: "Kataomoi", 
        artist: "Aimer",
        songPath: "../Music web/resources/songs/Japan/Aimer - Kataomoi.mp3", 
        img: "../Music web/resources/Images/Aimer-daydream.jpg",
    },
    
    { 
        id: 16,
        name: "Koidorobou 恋泥棒", 
        artist: "Yuika ユイカ",
        songPath: "../Music web/resources/songs/Japan/恋泥棒Koidorobou - ユイカ Yuika.mp3", 
        img: "../Music web/resources/Images/koidoro.jpg",
    },
    
    { 
        id: 17,
        name: "Kokoronashi - 心做し", 
        artist: "Majiko まじ娘",
        songPath: "../Music web/resources/songs/Japan/majiko  心做し LIVE.mp3", 
        img: "../Music web/resources/Images/kkrnsmjk.jpg",
    },
    
    { 
        id: 18,
        name: "Konomachi ni Hare wa Konai", 
        artist: "Minami",
        songPath: "../Music web/resources/songs/Japan/Minami - konomachi ni hare wa konai.webm", 
        img: "../Music web/resources/Images/knhw.jpg",
    },
    
    { 
        id: 19,
        name: "Lemon",
        artist: "Yonezu Kenshi",
        songPath: "../Music web/resources/songs/Japan/Lemon - 米津玄師.mp3", 
        img: "../Music web/resources/Images/lemon.png",
    },
    
    { 
        id: 20,
        name: "Monster", 
        artist: "Yoasobi",
        songPath: "../Music web/resources/songs/Japan/YOASOBI怪物 Monster.mp3", 
        img: "../Music web/resources/Images/monster.jpg",
    },
    
    { 
        id: 21,
        name: "Shiki opening song - Kuchizuke", 
        artist: "BUCK TICK",
        songPath: "../Music web/resources/songs/Japan/Kuchizuke BUCKTICK Shiki Opening.mp3", 
        img: "../Music web/resources/Images/shiki.jpg",
    },
    
    { 
        id: 22,
        name: "Secret Touch", 
        artist: "Snowman",
        songPath: "../Music web/resources/songs/Japan/Snow ManSecret Touch.mp3", 
        img: "../Music web/resources/Images/snowman.jpg",
    },
    
    { 
        id: 23,
        name: "Stay With Me", 
        artist: "Miki Matsubara",
        songPath: "../Music web/resources/songs/Japan/Miki Matsubara - Stay With Me HITACHI.mp3", 
        img: "../Music web/resources/Images/staywm.jpg",
    },
    
    { 
        id: 24,
        name: "Sukiga Afureteitano", 
        artist: "Mosawo もさを",
        songPath: "../Music web/resources/songs/Japan/Mosawo - Sukiga Afureteitano.mp3", 
        img: "../Music web/resources/Images/sukiga.jpg",
    },
    
    { 
        id: 25,
        name: "Tonikaku Kawaii Opening Song - FullKoi no Uta", 
        artist: "Yunomi",
        songPath: "../Music web/resources/songs/Japan/Tonikaku Kawaii Opening Song FullKoi no Utaby Yunomi.mp3", 
        img: "../Music web/resources/Images/tonikaku.jpg",
    },
    
    { 
        id: 26,
        name: "U", 
        artist: "millennium parade",
        songPath: "../Music web/resources/songs/Japan/millennium parade  U.mp3", 
        img: "../Music web/resources/Images/ump.jpg",
    },
    
    { 
        id: 27,
        name: "Violet Evergarden Opening song - Sincerely", 
        artist: "Miho Karasawa",
        songPath: "../Music web/resources/songs/Japan/yt1s.com - Lyrics MAD Violet Evergarden OP Full   Sincerely   TRUE HD.mp3", 
        img: "../Music web/resources/Images/ve.jpg",
    },
    
    { 
        id: 28,
        name: "Yellow", 
        artist: "Yoh Kamiyama",
        songPath: "../Music web/resources/songs/Japan/神山羊 Yoh Kamiyama - YELLOW.mp3", 
        img: "../Music web/resources/Images/yellow.jpg",
    },
    
    { 
        id: 29,
        name: "きらきら", 
        artist: "もさを弾き語りver",
        songPath: "../Music web/resources/songs/Japan/きらきら  もさを弾き語りver.mp3", 
        img: "../Music web/resources/Images/kirakira.jpg",
    },    
    
    { 
        id: 30,
        name: "そばにいて",
        artist: "Yuika ユイカ",
        songPath: "../Music web/resources/songs/Japan/そはにいて  ユイカ.webm", 
        img: "../Music web/resources/Images/soba.jpg",
    },
    
    { 
        id: 31,
        name: "ひび割れた世界", 
        artist: "Majiko",
        songPath: "../Music web/resources/songs/Japan/majiko  ひび割れた世界.mp3", 
        img: "../Music web/resources/Images/hibi.jpg",
    },
    
    { 
        id: 32,
        name: "命に嫌われている 歌ってみた", 
        artist: "Majiko",
        songPath: "../Music web/resources/songs/Japan/Majiko まじ娘 - 命に嫌われている 歌ってみた.mp3", 
        img: "../Music web/resources/Images/majiko2.jpg",
    },
    
    { 
        id: 33,
        name: "命に嫌われているカンザキイオリ", 
        artist: "Sou cover ver",
        songPath: "../Music web/resources/songs/Japan/命に嫌われているカンザキイオリCoververSou.mp3", 
        img: "../Music web/resources/Images/soucover.jpg",
    },
    
    { 
        id: 34,
        name: "感情を込めてハレハレヤ 歌ってみた", 
        artist: "Sou ver",
        songPath: "../Music web/resources/songs/Japan/感情を込めてハレハレヤ 歌ってみた verSou.mp3", 
        img: "../Music web/resources/Images/souver.jpg",
    },
    
    { 
        id: 35,
        name: "Kuruoshiihodo Bokuniwa Utsukushii 狂おしいほど僕には美しい", 
        artist: "Majiko",
        songPath: "../Music web/resources/songs/Japan/majiko - 狂おしいほど僕には美しい.mp3", 
        img: "../Music web/resources/Images/kuruo.jpg",
    },
];

const sortNames = songs.sort( (a, b) => a.name.localeCompare(b.name) );

let containerFluid = document.querySelector(".container-fluid");
const autocompleteTag = document.getElementsByClassName("searchSongs")[0];
let pre = document.querySelector(".pre");
let play = document.querySelector(".play");
let pause = document.querySelector(".pause");
let next = document.querySelector(".next");
let player = document.querySelector(".player");
let showSongContainer = document.querySelector(".showSongContainer");
const loading = document.querySelector("#preloader");
let currentStart = document.querySelector(".currentS");
let currentEnd = document.querySelector(".currentE");
let bar = document.querySelector(".bar");
let bar2 = document.querySelector(".bar2");
let dot = document.querySelector(".dot");
const repeat = document.querySelector(".repeat");
const repeatOneBtn = document.querySelector(".repeat-one");
const shuffle = document.querySelector(".shuffle");
const vol = document.querySelector(".vol");
const volInput = document.querySelector("#vol");
const volBar = document.querySelector(".vol-bar");
const vDot = document.querySelector("#vol-dot");

window.addEventListener("load", () => {
    setTimeout(() => {
        loading.classList.add("d-none");
        document.querySelector(".sBC").classList.remove("d-none");
        containerFluid.classList.remove("d-none");
        player.classList.remove("d-none");
     }, 1200);
});

let uploadUI = (songs) => {
    const songDetail = songs.map((element) => {
        return `
        <div class="songs d-flex flex-row">
            <div class="col-5 col-lg-2">
                <img src="${element.img}" class="img-fluid" alt="">
            </div>

            <div class="ms-3 ms-lg-5 text-light info d-flex flex-column justify-content-center">
                <h5>${element.name}</h5>
                <p>${element.artist}</p>
            </div>
        </div>
        <hr class="text-light">
        `;
    });

    containerFluid.innerHTML = songDetail;
};

uploadUI(sortNames);

let h5Tag = document.querySelectorAll("h5");

h5Tag.forEach ( ele => {
    // ele.textContent = `${sortNames[count].name}`;
    // count++;

    ele.addEventListener("click", () => {
        player.style.bottom = "0";

        pause.classList.add("d-none", "position-absolute");
        play.classList.remove("d-none", "position-absolute");
    });
});

//playing Songs
let audioTag = document.querySelector("audio");
let currentPlayingIndex = 0;

let playSong = (playSA) => {
    audioTag.src = playSA[currentPlayingIndex].songPath;
    audioTag.play();
};

for (let i = 0; i < h5Tag.length; i++) {
    // console.log(h5Tag[i]);

    h5Tag[i].addEventListener("click", () => {
        currentPlayingIndex = i;
        showSongContainer.innerHTML = `
        <div class="showSong d-flex flex-row">
            <div class="col-2 col-lg-1">
                <img src="${sortNames[i].img}" class="img-fluid" alt="">
            </div>

            <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                <h5>${sortNames[i].name}</h5>
                <p>${sortNames[i].artist}</p>
            </div>
        </div>
        `
        playSong(sortNames);
    });
};

//buttons play pause pre next
play.addEventListener("click", () => {
    play.classList.add("d-none");
    pause.classList.remove("d-none", "position-absolute");
    audioTag.pause();
});

pause.addEventListener("click", () => {
    pause.classList.add("d-none");
    play.classList.remove("d-none", "position-absolute");
    audioTag.play();
})

pre.addEventListener("click", () => {
    currentPlayingIndex--;
    if (currentPlayingIndex === -1) {
        currentPlayingIndex = sortNames.length - 1;
    }
    showSongContainer.innerHTML = `
        <div class="showSong d-flex flex-row">
            <div class="col-2 col-lg-1">
                <img src="${sortNames[currentPlayingIndex].img}" class="img-fluid" alt="">
            </div>

            <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                <h5>${sortNames[currentPlayingIndex].name}</h5>
                <p>${sortNames[currentPlayingIndex].artist}</p>
            </div>
        </div>
        `
    playSong(sortNames);

    if (play.classList.contains("d-none")) {
        pause.classList.add("d-none");
        play.classList.remove("d-none", "position-absolute");
    };
});

next.addEventListener("click", () => {
    currentPlayingIndex++;
    if (currentPlayingIndex === sortNames.length) {
        currentPlayingIndex = 0;
    }
    showSongContainer.innerHTML = `
        <div class="showSong d-flex flex-row">
            <div class="col-2 col-lg-1">
                <img src="${sortNames[currentPlayingIndex].img}" class="img-fluid" alt="">
            </div>

            <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                <h5>${sortNames[currentPlayingIndex].name}</h5>
                <p>${sortNames[currentPlayingIndex].artist}</p>
            </div>
        </div>
        `
    playSong(sortNames);

    if (play.classList.contains("d-none")) {
        pause.classList.add("d-none");
        play.classList.remove("d-none", "position-absolute");
    };
});

//progressBar
audioTag.addEventListener("timeupdate", (e) => {
    const currentTime = e.target.currentTime;
    const duration = e.target.duration;
    let bar2Width = (currentTime / duration) * 100;
    bar2.style.width = `${bar2Width}%`;
    dot.style.left = `${bar2Width}%`;

    audioTag.addEventListener("loadeddata", () => {
        let audioDur = audioTag.duration;
        let totalMin = Math.floor(audioDur / 60);
        let totalSec = Math.floor(audioDur % 60);
        if (totalSec < 10) {
            totalSec = `0${totalSec}`;
        }
        currentEnd.innerText = `${totalMin}:${totalSec}`;
    });

    let currMin = Math.floor(currentTime / 60);
    let currSec = Math.floor(currentTime % 60);
    if (currSec < 10) {
        currSec = `0${currSec}`;
    }
    currentStart.innerText = `${currMin}:${currSec}`;
});

bar.addEventListener("click", (e) => {
    console.log(e)
    let progressWidthval = bar.clientWidth; //getting width of progress area
    let clickedOffSetX = e.offsetX; //getting offset x value
    let songDur = audioTag.duration;

    audioTag.currentTime = (clickedOffSetX / progressWidthval) * songDur;
    pause.classList.add("d-none");
    play.classList.remove("d-none", "position-absolute");
    audioTag.play();
});

//loop and shuffle songs
repeat.addEventListener("click", () => {
    repeat.style.fill = "#36e2ec";
    shuffle.style.fill = "#fff";
    repeatOneBtn.style.fill = "#fff";
    repeat.classList.add("active");
    repeatOneBtn.classList.remove("active2");
    shuffle.classList.remove("active3");
});

repeatOneBtn.addEventListener("click", () => {
    repeatOneBtn.style.fill = "#36e2ec";
    repeat.style.fill = "#fff";
    shuffle.style.fill = "#fff";
    repeatOneBtn.classList.add("active2");
    repeat.classList.remove("active");
    shuffle.classList.remove("active3");
});

shuffle.addEventListener("click", () => {
    shuffle.style.fill = "#36e2ec";
    repeat.style.fill = "#fff";
    repeatOneBtn.style.fill = "#fff";
    shuffle.classList.add("active3");
    repeat.classList.remove("active");
    repeatOneBtn.classList.remove("active2");
});

audioTag.addEventListener("ended", () => {

    if (repeat.classList.contains("active")) {
        currentPlayingIndex++;
        if (currentPlayingIndex === sortNames.length) {
            currentPlayingIndex = 0;
        }
        showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${sortNames[currentPlayingIndex].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${sortNames[currentPlayingIndex].name}</h5>
                    <p>${sortNames[currentPlayingIndex].artist}</p>
                </div>
            </div>
            `
        playSong(sortNames);

        if (play.classList.contains("d-none")) {
            pause.classList.add("d-none");
            play.classList.remove("d-none", "position-absolute");
        };
    }

    if (repeatOneBtn.classList.contains("active2")) {
        audioTag.currentTime = 0;
        playSong(sortNames);
    }

    if (shuffle.classList.contains("active3")) {
        let randIndex = Math.floor((Math.random() * sortNames.length) + 1);
        currentPlayingIndex = randIndex;
        showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${sortNames[currentPlayingIndex].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${sortNames[currentPlayingIndex].name}</h5>
                    <p>${sortNames[currentPlayingIndex].artist}</p>
                </div>
            </div>
            `
        playSong(sortNames);
    }

});

//volume
volInput.addEventListener("change", () => {
    let volValue = volInput.value;
    volBar.style.width = `${volValue}%`;
    vDot.style.left = `${volValue}%`;
    audioTag.volume = volValue / 100;
})

document.addEventListener("keypress", (event) => {
    // console.log(event);
    if (event.key === " ") {
        event.preventDefault();
        play.classList.add("d-none");
        pause.classList.remove("d-none", "position-absolute");
        audioTag.pause();
    }
});

//autocomplete
let filteredSongs = [];

autocompleteTag.addEventListener("keyup", (event) => {
    const searchSong = event.target.value.toLowerCase();

    filteredSongs = songs.filter(song => {
        return song.name.toLowerCase().includes(searchSong);
    });

    uploadUI(filteredSongs);

    // adding title of the song
    let h5Tag = document.querySelectorAll("h5");

    h5Tag.forEach(ele => {
        ele.addEventListener("click", () => {
            document.querySelector(".player").style.bottom = "0";

            pause.classList.add("d-none", "position-absolute");
            play.classList.remove("d-none", "position-absolute");
        });
    });

    //playing Songs
    for (let i = 0; i < h5Tag.length; i++) {
        // console.log(h5Tag[i]);
        
        h5Tag[i].addEventListener("click", () => {
            currentPlayingIndex = i;
            
            showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${filteredSongs[i].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${filteredSongs[i].name}</h5>
                    <p>${filteredSongs[i].artist}</p>
                </div>
            </div>
            `

            playSong(filteredSongs);
        });
    };

    //next and pre
    next.addEventListener("click", () => {
        // console.log(currentPlayingIndex)

        if (currentPlayingIndex === filteredSongs.length) {
            currentPlayingIndex = 0;
        }
        showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${filteredSongs[currentPlayingIndex].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${filteredSongs[currentPlayingIndex].name}</h5>
                    <p>${filteredSongs[currentPlayingIndex].artist}</p>
                </div>
            </div>
            `
        playSong(filteredSongs);

        if (play.classList.contains("d-none")) {
            pause.classList.add("d-none");
            play.classList.remove("d-none", "position-absolute");
        };
    });

    // console.log(currentPlayingIndex)
    pre.addEventListener("click", () => {
        console.log(currentPlayingIndex);
        if (currentPlayingIndex > filteredSongs.length) {
            currentPlayingIndex = filteredSongs.length - 1;
        }
        showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${filteredSongs[currentPlayingIndex].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${filteredSongs[currentPlayingIndex].name}</h5>
                    <p>${filteredSongs[currentPlayingIndex].artist}</p>
                </div>
            </div>
            `
        playSong(filteredSongs);
    });

    //loop and shuffle songs
    audioTag.addEventListener("ended", () => {
        if (repeat.classList.contains("active")) {
            if (currentPlayingIndex === filteredSongs.length) {
                currentPlayingIndex = 0;
            }
            showSongContainer.innerHTML = `
            <div class="showSong d-flex flex-row">
                <div class="col-2 col-lg-1">
                    <img src="${filteredSongs[currentPlayingIndex].img}" class="img-fluid" alt="">
                </div>

                <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                    <h5>${filteredSongs[currentPlayingIndex].name}</h5>
                    <p>${filteredSongs[currentPlayingIndex].artist}</p>
                </div>
            </div>
            `
            playSong(filteredSongs);

            if (play.classList.contains("d-none")) {
                pause.classList.add("d-none");
                play.classList.remove("d-none", "position-absolute");
            };
        };

        if (repeatOneBtn.classList.contains("active2")) {
            audioTag.currentTime = 0;
            playSong(filteredSongs);
        }

        if (shuffle.classList.contains("active3")) {
            let randIndex = Math.floor((Math.random() * filteredSongs.length) + 1);
            currentPlayingIndex = randIndex;
            showSongContainer.innerHTML = `
                <div class="showSong d-flex flex-row">
                    <div class="col-2 col-lg-1">
                        <img src="${filteredSongs[currentPlayingIndex].img}" class="img-fluid" alt="">
                    </div>

                    <div class="ms-3 text-light info d-flex flex-column justify-content-center">
                        <h5>${filteredSongs[currentPlayingIndex].name}</h5>
                        <p>${filteredSongs[currentPlayingIndex].artist}</p>
                    </div>
                </div>
                `
            playSong(filteredSongs);
        }
    });
});